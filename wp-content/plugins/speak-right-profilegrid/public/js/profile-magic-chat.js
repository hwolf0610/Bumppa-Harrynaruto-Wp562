function start_messenger(){var e=null;jQuery("#receipent_field").autocomplete({appendTo:"#pm-autocomplete",minLength:3,source:function(t,a){null!=e&&e.abort();var r=jQuery("#receipent_field").val();"@"==r.charAt(0)&&(r=r.substr(1));var s={action:"pm_autocomplete_user_search",name:r};e=jQuery.post(pm_chat_object.ajax_url,s,function(e){if(e){var t=jQuery.parseJSON(e);a(t),jQuery("#pm-autocomplete ul li").attr("tabindex","0")}})},select:function(e,t){e.preventDefault(),jQuery("#receipent_field_rid").val(t.item.id),pg_activate_new_thread(t.item.id)}}),jQuery("#message_display_area").scroll(function(){var e=get_active_thread_id();if(jQuery("#load_more_message").length&&(console.log(jQuery("#load_more_message").length),jQuery("#message_display_area").offset().top-100<=jQuery("#load_more_message").offset().top&&!jQuery("#load_more_message").attr("loaded"))){jQuery("#load_more_message").attr("loaded",!0);var t=jQuery("#load_more_message").attr("pagenum");show_thread_messages(e,t=parseInt(t)+1)}}),jQuery(function(){window.emojiPicker=new EmojiPicker({emojiable_selector:"[data-emojiable=true]",assetsPath:pm_chat_object.plugin_emoji_url,popupButtonClasses:"fa fa-smile-o"}),window.emojiPicker.discover()}),jQuery(".emoji-wysiwyg-editor").focusin(function(){get_active_thread_id();pm_get_messenger_notification("","typing")}),jQuery(".emoji-wysiwyg-editor").focusout(function(){get_active_thread_id();pm_get_messenger_notification("","nottyping")}),jQuery(document).ready(function(){var e=jQuery(".pmagic").find("a").css("color");jQuery(".pm-loader").css("border-top-color",e),jQuery(".pmagic .pm-blog-time").css("color",e),jQuery(".pmagic .pm-user-conversations-counter").css("color",e),jQuery(".pmagic #unread_thread_count").css("background-color",e),jQuery(".pmagic #unread_notification_count").css("background-color",e),jQuery(".pmagic .pm-blog-desc-wrap #chat_message_form input#receipent_field").css("color",e),jQuery(".pmagic .pm-new-message-area button").css("color",e),jQuery(".pmagic .pm-messenger-button svg").css("fill",e),jQuery(".pmagic .pm-thread-active .pm-conversations-container .pm-thread-user").css("color",e),jQuery(".pm-color").css("color",e),jQuery("#pg-friends .pm-selected-image svg").css("fill",e),jQuery(".pmagic .page-numbers .page-numbers.current").addClass("pm-bg").css("background",e),jQuery(".pm-group-view.pg-theme-seven .pg-profile-area-wrap").css("background",e),jQuery(".pmagic .pm-profile-tab-wrap .pm-profile-tab").hover(function(){jQuery(this).css("border-bottom-color",e)},function(){jQuery(this).css("border-bottom-color","transparent"),jQuery(".pm-section-nav-horizental .pm-profile-tab.ui-state-active").css("border-bottom-color",e)})})}function update_thread(){pg_show_all_threads(),show_thread_messages(get_active_thread_id(),1)}function pm_messenger_send_chat_message(e){if(e.preventDefault(),""===jQuery("#messenger_textarea").val())return alert(pm_chat_object.empty_chat_message),!1;if(""===jQuery("#receipent_field_rid").val())return alert("Enter a valid receipent"),!1;pm_messenger_send_message(jQuery("#chat_message_form").serializeArray());var t=jQuery.trim(jQuery(".emoji-wysiwyg-editor").html());jQuery(".emoji-wysiwyg-editor").html(""),jQuery("#messenger_textarea").val("");var a='<div id="" class="pm_msg_rf  pm-sending-msg" >'+jQuery(".pm-messenger-user-profile-pic").html()+'<div class="pm-user-description-row pm-dbfl pm-border">'+t+"</div>"+pm_chat_object.seding_text+"</div>";jQuery("#message_display_area").append(a)}function pm_messenger_send_message(e){var t=jQuery("#thread_hidden_field").val(),a={};jQuery.each(e,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value)):a[this.name]=this.value}),jQuery.post(pm_chat_object.ajax_url,a,function(e){show_thread_messages(t,1),jQuery("#message_display_area").scrollTop(jQuery("#message_display_area div:last").offset().top)})}function get_active_thread_id(){var e=jQuery("#threads_ul [active='true']"),t=jQuery(e).attr("id");if(void 0===t)t="";else var a=t.replace("t_id_","");return a}function pg_activate_new_thread(e){var t={action:"pm_activate_new_thread",uid:e};jQuery.post(pm_chat_object.ajax_url,t,function(e){console.log(e.tid),jQuery("#threads_ul").html(e.threads),pm_get_active_thread_header(e.rid),show_thread_messages(e.tid,1)},"JSON")}function pm_get_rid_by_uname(e){}function show_thread_messages(e,t){var a=(new Date).getTimezoneOffset(),r={action:"pm_messenger_show_messages",tid:e,loadnum:t,timezone:a};console.log(r),jQuery.post(pm_chat_object.ajax_url,r,function(e){jQuery("#thread_pane").length&&("1"==t?(jQuery("#message_display_area").html(e),jQuery("#message_display_area div:last").length&&jQuery("#message_display_area").scrollTop(jQuery("#message_display_area div:last").offset().top)):(jQuery("#message_display_area").prepend(e),jQuery("#message_display_area").scrollTop(jQuery("#load_more_message").offset().top+500)))})}function show_message_pane(e,t){jQuery("#pm-username-error").html(""),show_pg_section_right_panel(),jQuery("#threads_ul li").attr("active","false"),jQuery("#t_id_"+e).attr("active","true"),jQuery("#t_id_"+e+" #unread_msg_count").html(" ");var a=jQuery("#t_id_"+e).attr("uid");pm_get_active_thread_header(t),show_thread_messages(e,1),jQuery("#receipent_field_rid").attr("value",a),jQuery("#thread_hidden_field").attr("value",e),pm_messages_mark_as_read(e)}function pm_get_active_thread_header(e){var t={action:"pm_get_active_thread_header",uid:e};jQuery.post(pm_chat_object.ajax_url,t,function(e){jQuery("#userSection").html(e)})}function pm_messenger_notification_extra_data(e){jQuery.get(pm_chat_object.ajax_url,{action:"pm_messenger_notification_extra_data"},function(t){if(t){var a=jQuery.parseJSON(t);0!==a.unread_threads?(console.log(a.unread_threads),void 0===e&&""!=e||(e=jQuery("#unread_thread_count").html()),console.log(e),jQuery("#unread_thread_count").addClass("thread-count-show"),jQuery("#unread_thread_count").html(a.unread_threads),jQuery("#thread_pane").length&&pg_activate_new_thread(a.rid),e<a.unread_threads&&jQuery("#msg_tone")[0].play()):(jQuery("#unread_thread_count").html(""),jQuery("#unread_thread_count").removeClass("thread-count-show"))}})}function refresh_messenger(){start_messenger(),pm_messenger_notification_extra_data(),show_thread_messages(get_active_thread_id(),1)}var notification_request=null;function pm_get_messenger_notification(e,t){void 0===t&&(t="");var a={action:"pm_get_messenger_notification",timestamp:e,activity:t,tid:get_active_thread_id()};null!==notification_request&&notification_request.abort(),notification_request=jQuery.get(pm_chat_object.ajax_url,a,function(e){if(e){var t=jQuery.parseJSON(e);jQuery.isEmptyObject(t)?setTimeout(function(){pm_get_messenger_notification("")},4e3):("typing"==t.activity&&jQuery("#typing_on .pm-typing-inner").show(),"nottyping"==t.activity&&jQuery("#typing_on .pm-typing-inner").hide(),!0===t.data_changed&&(update_thread(),pm_messenger_notification_extra_data("")),setTimeout(function(){pm_get_messenger_notification(t.timestamp)},4e3))}})}function pm_messages_mark_as_read(e){var t={action:"pm_messages_mark_as_read",tid:e};jQuery.post(pm_chat_object.ajax_url,t,function(){jQuery("#unread_thread_count").html(""),jQuery("#unread_thread_count").removeClass("thread-count-show")})}function pm_messenger_delete_thread(e,t){if(null==t)return!1;jQuery(e).parent("div").parent("li").remove();var a={action:"pm_messenger_delete_threads",tid:t};jQuery.post(pm_chat_object.ajax_url,a,function(e){jQuery(".pm-message-thread-section").show();var t=jQuery.parseJSON(e);console.log(t),pm_get_active_thread_header(t.uid),show_thread_messages(t.tid,1)})}function pg_show_all_threads(){jQuery.post(pm_chat_object.ajax_url,{action:"pg_show_all_threads"},function(e){jQuery("#threads_ul").html(e)})}